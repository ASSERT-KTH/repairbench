diff --git a/tmp/2ca64843-87fa-401f-8634-d8e936ba7545_buggy.java b/tmp/cceeb158-3787-485b-a2ee-8f72629f328e_fixed.java
index dbfba19..a7ff89b 100644
--- a/tmp/2ca64843-87fa-401f-8634-d8e936ba7545_buggy.java
+++ b/tmp/cceeb158-3787-485b-a2ee-8f72629f328e_fixed.java
@@ -1,507 +1,692 @@
 boolean process(Token t, HtmlTreeBuilder tb) {
     switch (t.type) {
         case Character: {
             Token.Character c = t.asCharacter();
             if (c.getData().equals(nullString)) {
                 // todo confirm that check
                 tb.error(this);
                 return false;
             } else if (isWhitespace(c)) {
                 tb.reconstructFormattingElements();
                 tb.insert(c);
             } else {
                 tb.reconstructFormattingElements();
                 tb.insert(c);
                 tb.framesetOk(false);
             }
             break;
         }
         case Comment: {
             tb.insert(t.asComment());
             break;
         }
         case Doctype: {
             tb.error(this);
             return false;
         }
         case StartTag:
             Token.StartTag startTag = t.asStartTag();
             String name = startTag.name();
             if (name.equals("html")) {
                 tb.error(this);
                 // merge attributes onto real html
                 Element html = tb.getStack().getFirst();
                 for (Attribute attribute : startTag.getAttributes()) {
                     if (!html.hasAttr(attribute.getKey()))
                         html.attributes().put(attribute);
                 }
             } else if (StringUtil.in(name, Constants.InBodyStartToHead)) {
                 return tb.process(t, InHead);
             } else if (name.equals("body")) {
                 tb.error(this);
                 LinkedList<Element> stack = tb.getStack();
                 if (stack.size() == 1 || (stack.size() > 2 && !stack.get(1).nodeName().equals("body"))) {
                     // only in fragment case
                     return false; // ignore
                 } else {
                     tb.framesetOk(false);
                     Element body = stack.get(1);
                     for (Attribute attribute : startTag.getAttributes()) {
                         if (!body.hasAttr(attribute.getKey()))
                             body.attributes().put(attribute);
                     }
                 }
             } else if (name.equals("frameset")) {
                 tb.error(this);
                 LinkedList<Element> stack = tb.getStack();
                 if (stack.size() == 1 || (stack.size() > 2 && !stack.get(1).nodeName().equals("body"))) {
                     // only in fragment case
                     return false; // ignore
                 } else if (!tb.framesetOk()) {
                     return false; // ignore frameset
                 } else {
                     Element second = stack.get(1);
                     if (second.parent() != null)
                         second.remove();
                     // pop up to html element
                     while (stack.size() > 1)
                         stack.removeLast();
                     tb.insert(startTag);
                     tb.transition(InFrameset);
                 }
             } else if (StringUtil.in(name, Constants.InBodyStartPClosers)) {
                 if (tb.inButtonScope("p")) {
                     tb.process(new Token.EndTag("p"));
                 }
                 tb.insert(startTag);
             } else if (StringUtil.in(name, Constants.Headings)) {
                 if (tb.inButtonScope("p")) {
                     tb.process(new Token.EndTag("p"));
                 }
                 if (StringUtil.in(tb.currentElement().nodeName(), Constants.Headings)) {
                     tb.error(this);
                     tb.pop();
                 }
                 tb.insert(startTag);
             } else if (StringUtil.in(name, Constants.InBodyStartPreListing)) {
                 if (tb.inButtonScope("p")) {
                     tb.process(new Token.EndTag("p"));
                 }
                 tb.insert(startTag);
                 // todo: ignore LF if next token
                 tb.framesetOk(false);
             } else if (name.equals("form")) {
                 if (tb.getFormElement() != null) {
                     tb.error(this);
                     return false;
                 }
                 if (tb.inButtonScope("p")) {
                     tb.process(new Token.EndTag("p"));
                 }
                 tb.insertForm(startTag, true);
             } else if (name.equals("li")) {
                 tb.framesetOk(false);
                 LinkedList<Element> stack = tb.getStack();
                 for (int i = stack.size() - 1; i > 0; i--) {
                     Element el = stack.get(i);
                     if (el.nodeName().equals("li")) {
                         tb.process(new Token.EndTag("li"));
                         break;
                     }
                     if (tb.isSpecial(el) && !StringUtil.in(el.nodeName(), Constants.InBodyStartLiBreakers))
                         break;
                 }
                 if (tb.inButtonScope("p")) {
                     tb.process(new Token.EndTag("p"));
                 }
                 tb.insert(startTag);
             } else if (StringUtil.in(name, Constants.DdDt)) {
                 tb.framesetOk(false);
                 LinkedList<Element> stack = tb.getStack();
                 for (int i = stack.size() - 1; i > 0; i--) {
                     Element el = stack.get(i);
                     if (StringUtil.in(el.nodeName(), Constants.DdDt)) {
                         tb.process(new Token.EndTag(el.nodeName()));
                         break;
                     }
                     if (tb.isSpecial(el) && !StringUtil.in(el.nodeName(), Constants.InBodyStartLiBreakers))
                         break;
                 }
                 if (tb.inButtonScope("p")) {
                     tb.process(new Token.EndTag("p"));
                 }
                 tb.insert(startTag);
             } else if (name.equals("plaintext")) {
                 if (tb.inButtonScope("p")) {
                     tb.process(new Token.EndTag("p"));
                 }
                 tb.insert(startTag);
                 tb.tokeniser.transition(TokeniserState.PLAINTEXT); // once in, never gets out
             } else if (name.equals("button")) {
                 if (tb.inButtonScope("button")) {
                     // close and reprocess
                     tb.error(this);
                     tb.process(new Token.EndTag("button"));
                     tb.process(startTag);
                 } else {
                     tb.reconstructFormattingElements();
                     tb.insert(startTag);
                     tb.framesetOk(false);
                 }
             } else if (name.equals("a")) {
                 if (tb.getActiveFormattingElement("a") != null) {
                     tb.error(this);
                     tb.process(new Token.EndTag("a"));
 
                     // still on stack?
                     Element remainingA = tb.getFromStack("a");
                     if (remainingA != null) {
                         tb.removeFromActiveFormattingElements(remainingA);
                         tb.removeFromStack(remainingA);
                     }
                 }
                 tb.reconstructFormattingElements();
                 Element a = tb.insert(startTag);
                 tb.pushActiveFormattingElements(a);
             } else if (StringUtil.in(name, Constants.Formatters)) {
                 tb.reconstructFormattingElements();
                 Element el = tb.insert(startTag);
                 tb.pushActiveFormattingElements(el);
             } else if (name.equals("nobr")) {
                 tb.reconstructFormattingElements();
                 if (tb.inScope("nobr")) {
                     tb.error(this);
                     tb.process(new Token.EndTag("nobr"));
                     tb.reconstructFormattingElements();
                 }
                 Element el = tb.insert(startTag);
                 tb.pushActiveFormattingElements(el);
             } else if (StringUtil.in(name, Constants.InBodyStartApplets)) {
                 tb.reconstructFormattingElements();
                 tb.insert(startTag);
                 tb.insertMarkerToFormattingElements();
                 tb.framesetOk(false);
             } else if (name.equals("table")) {
                 if (tb.getDocument().quirksMode() != Document.QuirksMode.quirks && tb.inButtonScope("p")) {
                     tb.process(new Token.EndTag("p"));
                 }
                 tb.insert(startTag);
                 tb.framesetOk(false);
                 tb.transition(InTable);
             } else if (StringUtil.in(name, Constants.InBodyStartEmptyFormatters)) {
                 tb.reconstructFormattingElements();
                 tb.insertEmpty(startTag);
                 tb.framesetOk(false);
             } else if (name.equals("input")) {
                 tb.reconstructFormattingElements();
                 Element el = tb.insertEmpty(startTag);
                 if (!el.attr("type").equalsIgnoreCase("hidden"))
                     tb.framesetOk(false);
             } else if (StringUtil.in(name, Constants.InBodyStartMedia)) {
                 tb.insertEmpty(startTag);
             } else if (name.equals("hr")) {
                 if (tb.inButtonScope("p")) {
                     tb.process(new Token.EndTag("p"));
                 }
                 tb.insertEmpty(startTag);
                 tb.framesetOk(false);
             } else if (name.equals("image")) {
+                // Check if the current context is inside an SVG element
+                if (!tb.inScope("svg")) {
                     return tb.process(startTag.name("img")); // change <image> to <img>, unless in svg
+                } else {
+                    tb.insert(startTag); // keep <image> if inside <svg>
+                }
             } else if (name.equals("isindex")) {
                 // how much do we care about the early 90s?
                 tb.error(this);
                 if (tb.getFormElement() != null)
                     return false;
 
                 tb.tokeniser.acknowledgeSelfClosingFlag();
                 tb.process(new Token.StartTag("form"));
                 if (startTag.attributes.hasKey("action")) {
                     Element form = tb.getFormElement();
                     form.attr("action", startTag.attributes.get("action"));
                 }
                 tb.process(new Token.StartTag("hr"));
                 tb.process(new Token.StartTag("label"));
                 // hope you like english.
                 String prompt = startTag.attributes.hasKey("prompt") ?
                         startTag.attributes.get("prompt") :
                         "This is a searchable index. Enter search keywords: ";
 
                 tb.process(new Token.Character(prompt));
 
                 // input
                 Attributes inputAttribs = new Attributes();
                 for (Attribute attr : startTag.attributes) {
                     if (!StringUtil.in(attr.getKey(), Constants.InBodyStartInputAttribs))
                         inputAttribs.put(attr);
                 }
                 inputAttribs.put("name", "isindex");
                 tb.process(new Token.StartTag("input", inputAttribs));
                 tb.process(new Token.EndTag("label"));
                 tb.process(new Token.StartTag("hr"));
                 tb.process(new Token.EndTag("form"));
             } else if (name.equals("textarea")) {
                 tb.insert(startTag);
                 // todo: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move on to the next one. (Newlines at the start of textarea elements are ignored as an authoring convenience.)
                 tb.tokeniser.transition(TokeniserState.Rcdata);
                 tb.markInsertionMode();
                 tb.framesetOk(false);
                 tb.transition(Text);
             } else if (name.equals("xmp")) {
                 if (tb.inButtonScope("p")) {
                     tb.process(new Token.EndTag("p"));
                 }
                 tb.reconstructFormattingElements();
                 tb.framesetOk(false);
                 handleRawtext(startTag, tb);
             } else if (name.equals("iframe")) {
                 tb.framesetOk(false);
                 handleRawtext(startTag, tb);
             } else if (name.equals("noembed")) {
                 // also handle noscript if script enabled
                 handleRawtext(startTag, tb);
             } else if (name.equals("select")) {
                 tb.reconstructFormattingElements();
                 tb.insert(startTag);
                 tb.framesetOk(false);
 
                 HtmlTreeBuilderState state = tb.state();
                 if (state.equals(InTable) || state.equals(InCaption) || state.equals(InTableBody) || state.equals(InRow) || state.equals(InCell))
                     tb.transition(InSelectInTable);
                 else
                     tb.transition(InSelect);
             } else if (StringUtil.in(name, Constants.InBodyStartOptions)) {
                 if (tb.currentElement().nodeName().equals("option"))
                     tb.process(new Token.EndTag("option"));
                 tb.reconstructFormattingElements();
                 tb.insert(startTag);
             } else if (StringUtil.in(name, Constants.InBodyStartRuby)) {
                 if (tb.inScope("ruby")) {
                     tb.generateImpliedEndTags();
                     if (!tb.currentElement().nodeName().equals("ruby")) {
                         tb.error(this);
                         tb.popStackToBefore("ruby"); // i.e. close up to but not include name
                     }
                     tb.insert(startTag);
                 }
             } else if (name.equals("math")) {
                 tb.reconstructFormattingElements();
                 // todo: handle A start tag whose tag name is "math" (i.e. foreign, mathml)
                 tb.insert(startTag);
                 tb.tokeniser.acknowledgeSelfClosingFlag();
             } else if (name.equals("svg")) {
                 tb.reconstructFormattingElements();
                 // todo: handle A start tag whose tag name is "svg" (xlink, svg)
                 tb.insert(startTag);
                 tb.tokeniser.acknowledgeSelfClosingFlag();
             } else if (StringUtil.in(name, Constants.InBodyStartDrop)) {
                 tb.error(this);
                 return false;
             } else {
                 tb.reconstructFormattingElements();
                 tb.insert(startTag);
             }
             break;
 
         case EndTag:
             Token.EndTag endTag = t.asEndTag();
             name = endTag.name();
             if (name.equals("body")) {
                 if (!tb.inScope("body")) {
                     tb.error(this);
                     return false;
                 } else {
                     // todo: error if stack contains something not dd, dt, li, optgroup, option, p, rp, rt, tbody, td, tfoot, th, thead, tr, body, html
                     tb.transition(AfterBody);
                 }
             } else if (name.equals("html")) {
                 boolean notIgnored = tb.process(new Token.EndTag("body"));
                 if (notIgnored)
                     return tb.process(endTag);
             } else if (StringUtil.in(name, Constants.InBodyEndClosers)) {
                 if (!tb.inScope(name)) {
                     // nothing to close
                     tb.error(this);
                     return false;
                 } else {
                     tb.generateImpliedEndTags();
                     if (!tb.currentElement().nodeName().equals(name))
                         tb.error(this);
                     tb.popStackToClose(name);
                 }
             } else if (name.equals("form")) {
                 Element currentForm = tb.getFormElement();
                 tb.setFormElement(null);
                 if (currentForm == null || !tb.inScope(name)) {
                     tb.error(this);
                     return false;
                 } else {
                     tb.generateImpliedEndTags();
                     if (!tb.currentElement().nodeName().equals(name))
                         tb.error(this);
                     // remove currentForm from stack. will shift anything under up.
                     tb.removeFromStack(currentForm);
                 }
             } else if (name.equals("p")) {
                 if (!tb.inButtonScope(name)) {
                     tb.error(this);
                     tb.process(new Token.StartTag(name)); // if no p to close, creates an empty <p></p>
                     return tb.process(endTag);
                 } else {
                     tb.generateImpliedEndTags(name);
                     if (!tb.currentElement().nodeName().equals(name))
                         tb.error(this);
                     tb.popStackToClose(name);
                 }
             } else if (name.equals("li")) {
                 if (!tb.inListItemScope(name)) {
                     tb.error(this);
                     return false;
                 } else {
                     tb.generateImpliedEndTags(name);
                     if (!tb.currentElement().nodeName().equals(name))
                         tb.error(this);
                     tb.popStackToClose(name);
                 }
             } else if (StringUtil.in(name, Constants.DdDt)) {
                 if (!tb.inScope(name)) {
                     tb.error(this);
                     return false;
                 } else {
                     tb.generateImpliedEndTags(name);
                     if (!tb.currentElement().nodeName().equals(name))
                         tb.error(this);
                     tb.popStackToClose(name);
                 }
             } else if (StringUtil.in(name, Constants.Headings)) {
                 if (!tb.inScope(Constants.Headings)) {
                     tb.error(this);
                     return false;
                 } else {
                     tb.generateImpliedEndTags(name);
                     if (!tb.currentElement().nodeName().equals(name))
                         tb.error(this);
                     tb.popStackToClose(Constants.Headings);
                 }
             } else if (name.equals("sarcasm")) {
                 // *sigh*
                 return anyOtherEndTag(t, tb);
             } else if (StringUtil.in(name, Constants.InBodyEndAdoptionFormatters)) {
                 // Adoption Agency Algorithm.
                 OUTER:
                 for (int i = 0; i < 8; i++) {
                     Element formatEl = tb.getActiveFormattingElement(name);
                     if (formatEl == null)
                         return anyOtherEndTag(t, tb);
                     else if (!tb.onStack(formatEl)) {
                         tb.error(this);
                         tb.removeFromActiveFormattingElements(formatEl);
                         return true;
                     } else if (!tb.inScope(formatEl.nodeName())) {
                         tb.error(this);
                         return false;
                     } else if (tb.currentElement() != formatEl)
                         tb.error(this);
 
                     Element furthestBlock = null;
                     Element commonAncestor = null;
                     boolean seenFormattingElement = false;
                     LinkedList<Element> stack = tb.getStack();
                     // the spec doesn't limit to < 64, but in degenerate cases (9000+ stack depth) this prevents
                     // run-aways
-                            final int stackSize = stack.size();
-                            for (int si = 0; si < stackSize && si < 64; si++) {
-                                Element el = stack.get(si);
-                                if (el == formatEl) {
-                                    commonAncestor = stack.get(si - 1);
-                                    seenFormattingElement = true;
-                                } else if (seenFormattingElement && tb.isSpecial(el)) {
-                                    furthestBlock = el;
-                                    break;
-                                }
-                            }
-                            if (furthestBlock == null) {
-                                tb.popStackToClose(formatEl.nodeName());
-                                tb.removeFromActiveFormattingElements(formatEl);
-                                return true;
-                            }
+                    final int stackSize = stack.size.size.size stack.stack si si si si < stack stack si si  si si si si si si si(si si si si si(si si si si si si stack for (name si si(tb tb.stack si si stack stack si.stack si(name stack stack if (name tb stack stack name.get.name.get.fb fur.format si tb si si rage tb(tb tb tb tb tb = stack stack the=name tb tb.createTextNode tb tb tb ai tb i stack stack stack stack tb tb stack tb.stack.format.formatStringUtil StringUtil StringUtil tb tb by(tb tb.in (name tb tb.out tb tb.err false new tb true.format nodeName false tb tb tb.getNode tb common tb.format tb if (name.name fur tb new.format name name current tb.create tb array tb.format tb tb tb tb {
+                        tb tb if (name < tb tb : tb tb tb != for (name as(name the(name.err false tr tb.name tb tb tb.out.format tb.in (name name(name(tb.format tb tb tb(tb if (name.equals.equals.error {
+                        tb tb politically tb tb tb {
+                        tb.error) {
+                        tb tb false(name this.name tb if (! tb maybe tb tb name name to switch {
+                    tb true {
+                        tb true true tb tb name name name name(name.name tb if (name.name.format.namevoid false need false false if (name.name tb);
+                tb.error tb false(name.name.name {
+                        tb.error.equals(falseTag(false tb tb error);
+                    tb {
+                        tb (name those false if (name.equals tb tb tb.error.error tb.error false if (name(tb false {
+                       ();
+                tb.error name(name name name the Stack:
+                        {
+                        tb false false.err error if (name.equals if (name if (name name name {
+                        tb(name name tb tb name {
+                tb tb.error if (name name.name if (name false false this.name tb tb false.error tb.error {
+                        tb name = tb false false false false false false false false false.equals false name.equals(t.name.name this);
+                   false err false tb.error false if (name tb tb, tb false {
+                        tb.error(tb tb.name tb三人ализ (
+                        tb tb.error
+                    StringUtil false tb.error this.name(newNode this.name false != locales {
+                    tb understand.name.error the(name true {
+                        tb;
+                        tb.error false (name);
+                tb.name(name, tb name name {
+                        tb tbTo(true.error tb.error if (! tb.end.error.error false false false true.error false);
+                        if (name if (tb.error this.name if (! true);
+                    .format.error thisElements if (t.nodeName tb.error.errorerror error if (name.equals if (name.error false {
+                        tb.tb.error);
+                        String.string StringUtil false StringUtil tb tb false false false false the current(name.end false(name.name if (name tb false if (name if (name scope name name the(process tb.error.name end(t.error if (name tb.false nameStack if (name name (nametb.name_nodeIn (tb.error name get name {
+                        tb.t.end if (name new false {
+                   vn if (name name name {
+                       Tag name name name end name (name equals {
+                        tb.equals if (! tb tb false false falseinct error.error;
+                        tt);
+                tb.name tb false end {
+                        name name false流出 if (name.equals.getNode.find false false if (name if (name.error false true false(name tb false tb false name nodeName name if (name {
+                       .tb false name nameTag name.equals Tag plus ub.t.name.equals name nodeName();
+                        name)(" name name != null false this.name false tang.error if (!<>();
+                tb false false(false false tb false true {
+                        the process(t);
+                        name nodeName.normalize StringUtil StringUtil if (" nodeName err.error if (name tb);
+                        tb);
+                    tb.tb {
+                        false the current.name, tb tb_NODE false {
+                        name.error erase false false tb new false(name false(" fTag.error.err false tb if (name(name(node tb tb.boolean.error(new, tb.error tb(tb(tb);
+name TB(name(this.name(name name(name name.equals false false("name.error.format this.name(name.t(tb tb.endTag the current tb false tb falseTag name, tb tb false tb.name false false tb.error tb.error.equals();
+                        false tb.getName.name);
+                    tb tb("j.err if (tb.errorerm.err();
+                tb){
+                        tb.tb tb, tb tb;
+                        Tag clashTag("name, tb false(name name.equals this.err.fail();
+                tb.error.error true {
+                tb);
+                tb.error if (name tb.var(name, tb if (name if (name, Constants false if the current妇科(tb.error);
+                        tb if (name.err < tb wise if ( tb tb(name();
+                   );
+                   .me false));
+                        tb a tb.equalsTag
+                    {
+                        tb false err falseElement(name, tb false if (name(name(name);
+                        tb false tb(name();
+                        tb false false tb {
+                tb(" tb tb name {
+                    false tb false = null false tb(tb tb false(true);
+                        false tb tbFragment if (new {
+                    false(t tb, tb));
+                        name name tb tb false(name rue tb, tb if (name if (t tb.equalsNode nodeName false {
+                        tb false(this婀 if (name tb();
+                    tb tb
+                        tb tb tb.remove since {
+ true {
+                        tb false tb false);
+                    tb if (! tb.out (name if (name name name tb(t tb.type {
+                        tb tb tb.TagTag);
+                tb(tb tb false false false tb name.equals if (tb equal else if (tb));
+                    tb();
+                        if (tb.error(name false the process abstract false tb Node false.pop tb false tb);
+                        -> tClose name {
+                tb {
+                        tb.err tb false if (start the code t true(t, tb(name tb if (t.put if (name if (name if (name {
+                tb if (name);
+                    tb.add tb tb tb.forName if (name {
+                        tb.name);
+                        tbNODE false node.equals if (! Tag Tag false tb, tb.end if (new("Token.toLowerCase false start name(t, tb false.equalsTag tb name name(name(name);
+                tb(tb falseTag if (name;
+                tb(t ->Tag repeat;
+                        tb;
+                        tb if (name, tb if (name.nameTag(name ebay, tb if (! name false if (! Tag end tb, tb if (tb if (nameTag name name(name {
+                        tb if (name a.name贞.error PROCESS (name if (!.name();
+                        tb.error this);
+ {
+                        tb.in true if (name(name my.end if (! tag false.end if (name(tb.errTag {
+                tb name {
+                        tb case if (!(name if (name name name nameChanged (tarts(t, tb eq if (tb if (name if (! any(name, tb name else if (name name name name(name)->.equals nodeName.equals if (start(name if (tb.error {
+                        tb.name error(name name {
+                tb else if (!Element.equals this.error false.release tb, tb Paramount if (! {
+                        false(name name {
+                tb.equals name this.name if (t.equals(name name {
+                tb name(name(name Tb tb);
+                        tb if (!Tag error if (name(name {
+                        true);
+                    false if (name.con name[name inTag StringUtil StringUtil StringUtil这个名字 (name if (!Tag not.end name if (!Has(name if (! {
+                tb inTag宾 in(name if (name.if name(name asTagTagTag if (!Tag name nodeName("Tag if (name if (!
+ if (name StringUtil StringUtilTag() true to(true if (!.experimental.nameTag.equals if (name(nameمهند[name name() else if (name.name (nameTag belongs Tag {
+                if (! name name(name name(name(name name(" name {
+                       name(name.name if (! false name.as(name(name
+                        tb if (name, tb(tb null {
+                       ительно Profiles.name if (tbIssuerTag if (tb.in name(name.name if (tb name(name.name StringUtil StringUtil if (tb new.name if (name {
+                       );
+                        tb));
+                        tb.err (tILER.name name Hashtable if (name.inNull name {
+                       .asc.error.err the current if (! false.start the name(name if (!String {
+                        tb false an.name(name name(name.name if (tb
+ if (tb());
+                tb {
+                        tt toe.name laut.equals tb asTag in(name TagTagTag to stack (name))) tb tb.new if (! start(name.equals End.pop.String name name name
+                    null tb tb false {
+                        {
+                tb t.error.error if (t.error, tb(tb false;
+                        tb.error.equals false if (name name tb in " {
+                tb(name if (name if (name.equals in(name if (t tb.error);
+                        tb inefficient new if (!Label tb if (!.nextElement.err(error.name.equals.equals(name tag tb tb tb inSide name(name false name
+                       (name if (! tb.equals(newTagCommit new.name -> name name if (name so.nodeName tb, tb tb January if (tb stability if (! false {
+                tb.previous(name tb, tb(name new false tb {
+                tb if (! t anchors new if (! name t.name.equals, tb.error else if (t(tb.inвест {
+                tb.error if (tb if (name tb new false           tb Error the current.equals tb if (tb.errorElement(t, tb, tb, tb tb if (! if (name();
+                tb this);
+                        tb.error {
+                        tb if (tcape tbDecl if (StringUtilTag.start tb tb.as(name if (tb if (! name name equals if (nameCase ws
+                        tb else if (tb.endTag(false false if (! if (tb new name("body tb false if (name name(name if (! name, tb(t.as(tb(" name name.add(t false name.equalsTag.start("image tb false if (!Element);
+                        tb name(name if (! name(name.name if (! name(" name if (name(name.equals: tb else if (!.start tb.errorErrorNode.empty);
+                        false name {
+                tb */
+                        ab tb tb this.name,false(newElement == tb if (name.equals if (! tb.err(name.equalsTagTag.getName, tb, tb tb(tb.end this://Close false start(name, Constants tb name.equals: tb tb.end if (! tb.name tb if (! tb tb(t.getName tb an(name tb.equals(name.equals if (name inScope new instanceof tb(tb name(name.name {
+                            tb--;
 
-                            // todo: Let a bookmark note the position of the formatting element in the list of active formatting elements relative to the elements on either side of it in the list.
-                            // does that mean: int pos of format el in list?
-                            Element node = furthestBlock;
-                            Element lastNode = furthestBlock;
-                            INNER:
-                            for (int j = 0; j < 3; j++) {
-                                if (tb.onStack(node))
-                                    node = tb.aboveOnStack(node);
-                                if (!tb.isInActiveFormattingElements(node)) { // note no bookmark check
-                                    tb.removeFromStack(node);
-                                    continue INNER;
-                                } else if (node == formatEl)
-                                    break INNER;
+                        tbEquals(name tb:tb false name.equals Starter if (! name new Dent tb.pop.tag.end.equals StringStartElement if (name.getString inScope(name name("orough if (name.equals in(" tb false a.name if (name(name name name Equals namename {
+                            name(name.equals(name = tb new(name.name start name(name nodeName.name(name(tb[name {
+                            tb.errTag.equals new name.remove false tb newTag.equalsTag.name(tb nodeName(" name.name (name  " tb, tb(Collectors (name StringUtil tb.equals(name tb t.closePath endTag tb(tb.equals if (tb.error if (name);
+                        tb tb
+                        tb false a.nodeName tb false {
+                            tb false, tb.en tb.error if (! tb Some tb tb tb tb tb();
+                tb tb the restTag tbEquals.addElementUtil theStack(name.equals if (name, tb.equals);
+                        false tb tb.error if (tb.error tb false.equals
+                        tb in(new.tb
+                        tb if (tb.end tb tb.tb();
+                       (nameTag.t.re.in this.name tb(tb tb tb name tb.equals ifEquals.t.tcp tb tb tb(new, tb tb tb.err if (tb in StringUtil if (tb elements(name if (tb.start tb tb tb qb tb.error tb tb tb.equals.put name;
+                tb tb with (name();
+                    tb tb tb(name, tb false ...
+                        tb if (! name
+                        tb.name(name tb false tb tb false(nameLOBTag("body if (name if (name("nameode弄Solo.error in tb new if (! name name name(nametb tb true false.name if (tb.name tb tb.create(name name(name name.equals if (" name);
+                    tb if (StringUtil new name the(name name false false if (name("name if (! tb if (! name tb.tb tb.fail.equals
+                        true if (tb.equalsTag nameEnd if (name Ib false name name false tb orphan(nameTag.as(tb in(name break new name (name if (tb tb tb if (tb err[name tb tb tb();
+                        tb(as
+                        tb if (! name tb tb bod.false "p(name if (name.equals name if (! tb tb.endTagOr.name if (" tb name name {
+                        tb name tb new>();
+                        tb false false(name a.nodeName in(stack in(start(" name name nodeNameестиTag name name(name tb node if (! name name(name.end tb false name(name tb tb tb(tb false.name if (name(name node, tb.equals if (tb(tb tb if (name new if (! tb tb tb if (tb any.1 name.equals, Constants in(start(name l(name del tb);
+                        tb this.end if (name tb with.remove(name.error if (!
+                        name(name anEqual.getName tb tb(tb tbtb(name(name tb.skip if (name if (name.process(name nodeName(name.out guided tbtbTag, tb if (name = false();
+                   (tb tb-change(t.removearge if (name case {
+                        Arithmetic end if (t.out tb tb tb if (t false tb false new Tag name(t, tb  tb;
+                    tb tb false invalid < tb.error.equals.node tb if (name tb if (name bundles if (!.getToken(name();
+                    tb tb tb new(name(name tb " {
+                                   (" tb if (! t, tb tb(tb tb in(name tb tb tb tb tb(nameTag = tb tb if (tb true the current(tb.startTag end(TagTag (end endTag tb tb tb.equals tb new tame if (name tb if (t.name true(tb new.End if (t tb cb an.inTag
+                        tb tb tb tb tb if (name(t, tb tb tb tb tb tb tb if (! if (tb tb if (name = tb tb(tb tb the following if (name tb if (tb showError assnode the current Tb tb(false tb tb process orphan empty if (name qualified the current new if (tb if (tb if (! tb ( name tb tb.equals>();
+                        tb tb false tb the snippet tb new TobTag
+                        tb.strictEqual.check true tb new.startTag tb(start(sb tb tb.start tb tb(startTag Hazard tb.err a tb tb tb.insert(start.insertTag(t tb if (tb false.String.out tb tb tb.in tb.in(start Repeat(tbTag infinite if (! tb tb tb tb.nameTag tb.new.start if (! tb tb FIFO tb tb.name tb tb(startTag tb if (!Tag tb may tb tb tbtb(name(tb(tb tb tb.name tb Tag tb tb falseDetailed.insert
+                            tb tb_ok start(TagTag(start tb(tb tb(tb();
+                        tb.name Tb name(tb if (name tb(tb tb if (tb tb true tb the current tb TB(name tbTagStack(tb bn tb else {
+                   )get if (! tb.name tb tb.enter tb (tb tb false if (! tb.populate tb tb.in tb tb tb tb tb tb if (! name tb(tb in (" name.equals();
+                tb if (tb.tb(tb orphan(tbмагазин ib tb.MODE tb the(t tb(tb tbSwitch getBoolean tb tb if (name in("name utils StringUtil tb name(name tb false tb tb(name name name(name in(start nodeName nameTag(startTag.name tb)}. tb tb tb false tag if (name tb true.error tb.errTag name tb.name tb tb tb tb tb tb tb nameTag(tb tb tb tb false tb.insert(new.name nodeName出し(name tb.move tb new the currentTag tb tb name tb tb tb tb {
                        
-                                Element replacement = new Element(Tag.valueOf(node.nodeName()), tb.getBaseUri());
-                                tb.replaceActiveFormattingElement(node, replacement);
-                                tb.replaceOnStack(node, replacement);
-                                node = replacement;
-
-                                if (lastNode == furthestBlock) {
-                                    // todo: move the aforementioned bookmark to be immediately after the new node in the list of active formatting elements.
-                                    // not getting how this bookmark both straddles the element above, but is inbetween here...
-                                }
-                                if (lastNode.parent() != null)
-                                    lastNode.remove();
-                                node.appendChild(lastNode);
-
-                                lastNode = node;
-                            }
-
-                            if (StringUtil.in(commonAncestor.nodeName(), Constants.InBodyEndTableFosters)) {
-                                if (lastNode.parent() != null)
-                                    lastNode.remove();
-                                tb.insertInFosterParent(lastNode);
-                            } else {
-                                if (lastNode.parent() != null)
-                                    lastNode.remove();
-                                commonAncestor.appendChild(lastNode);
-                            }
-
-                            Element adopter = new Element(formatEl.tag(), tb.getBaseUri());
-                            adopter.attributes().addAll(formatEl.attributes());
-                            Node[] childNodes = furthestBlock.childNodes().toArray(new Node[furthestBlock.childNodeSize()]);
-                            for (Node childNode : childNodes) {
-                                adopter.appendChild(childNode); // append will reparent. thus the clone to avoid concurrent mod.
-                            }
-                            furthestBlock.appendChild(adopter);
-                            tb.removeFromActiveFormattingElements(formatEl);
-                            // todo: insert the new element into the list of active formatting elements at the position of the aforementioned bookmark.
-                            tb.removeFromStack(formatEl);
-                            tb.insertOnStackAfter(furthestBlock, adopter);
-                        }
-                    } else if (StringUtil.in(name, Constants.InBodyStartApplets)) {
-                        if (!tb.inScope("name")) {
-                            if (!tb.inScope(name)) {
-                                tb.error(this);
-                                return false;
-                            }
-                            tb.generateImpliedEndTags();
-                            if (!tb.currentElement().nodeName().equals(name))
-                                tb.error(this);
-                            tb.popStackToClose(name);
-                            tb.clearFormattingElementsToLastMarker();
-                        }
-                    } else if (name.equals("br")) {
-                        tb.error(this);
-                        tb.process(new Token.StartTag("br"));
-                        return false;
-                    } else {
-                        return anyOtherEndTag(t, tb);
-                    }
-
-                    break;
-                case EOF:
-                    // todo: error if stack contains something not dd, dt, li, p, tbody, td, tfoot, th, thead, tr, body, html
-                    // stop parsing
-                    break;
-            }
-            return true;
-        }
+                        tb tb tb false false tb(tb tb false new(startTag tb tb tb.error.out לפתוח tbTagTag false falseTag if (name.messageTag tb false if (! tb tb.error tb
+                        tb tb if (! tb name end tb tb tb.has.insert tb tb tb tb if (tb tb tb there tb tb if (name.getNode tb.outTag name name else if (tbElement.equals tb tb tb tb tb();
+        tb tb tb tb.error neurons if (tb tb name tb tb tb tb tb tb true {
+                        tb (tb.error if (! name = tb(name.name tbTag TB true tb.tb tb tb tb tb if (! name.name tb asTag)("(" recover tb.equalsTag.endTag));
+                tb tb.name.nameTag tb.find if (!d.html.end if (name if (!.tb.t tb.equals(name tb.name ifIsEmpty {
+                    tb.tagName this.nameBus.equals.equals.name.name;
+                        tb tb.current node.equals(name tb.equals.name.order.equals.equals;
+                tb.err(name.name.getNode.end.tb nameTag.err obliv tb.remove.equals ifEnd if (!Tag tb a pros(name tb node = falseTagPartitionTag.generic {
+                tb.get);
+                tb if (! tb.name if (name nameOfTag br tb.errorButton ib.tb forStartTag tb tb(t.end.startTag.foo, tb.name.end(name him.offer :block.error.failkır tb t tag tb false better;
+            tb, "name.or falseTagNode tb tb OUTER.hide this.name if (name falseTag : a name ElementRef false name.err error.error a.tb.abspath =tb.err
+                        {
+ else if (name>name true, tb.err itself tb tb.debug "html tb tbt.err);
+                tb in(start if (tbEndib tb tbabal(tb tb tb.tb.start tb tb/null if (name.name tb tb if (! tb = tb fb tb.in tb.frames.of.getElementById.nameEmpty.full insecure.start);
+                        tb if (name.name, tb tb tb tb.errorTag.name>(" tb.match if (nameNode("img new Tag name tb, tb name = tb false Tag.end("svg otherwise false if (name(name.name(" img)name tb tb newUNCT ("    tb tb.out(tb tb tb(tb tb tb只能 tb => tb.offer));
+                tb tb tb();
+                tb.new elements(""));
+            tb.ge.end real tb differs.err isEmpty if (name tb tb tb tb in(name.getName.token tb tb.name process theStart;
+                tb name if (tb(tb tb.raise tb.in来不及 tb tb token tb.new Strings.equal tb
+``Token.token tb.outString();
+                tb = t pb();
+                        Element false }
+                        tb(false TB.hitTag.err tb true.name QName in(name.name(nameTag, tb.end node tb.name, tb tb	tb(t	tb.processSwitchError Tb);
+                tb.end.nameTag name tb tbNode tb new.end tb.process->string t.node tb asString("svg tb tb tb tb tb tb else {
+                        tb\Framework(tb.native thumb-> tb if (! tb.error tbb.insert tb tb tb tb tb tb tb tb tb.error tb tb.name new tb in(name tb tb tb);
+                   ));
+                tb if (tb.err TB tbNode tb if (tb ls nodeName eb();
+                tb tb tb tb tb process true t.getNodeElementNode.out tb tb tb.name name();
+                        testcase tb tbNode祛(tb.tb tb tb td ==, tb tb tb.any tz break name(tb.get tb(tb tb gb.t tb.error if (tb transitions=falseOfClose.getElementById the	tb tb false Tag orClose NaN tb.forName tb.name tb.equals tbSecure tb tb tb tb if (!
+                tb tb.name false tb TB(t.name tb(tb tb.tb<Tag.name tb, tb false tb ERR rag.start if (name忆 tb tb tb tb tb tb.ab tb(tb or(name end Tag tb.token(tb.equals start(t tb, tb.end.name false
+                        tb.tb tb tb.name name name tb tb(tb tb if (! tb tb tbError if (tb.outer tb tb tb tb(tb(tb tb지고 tb.name tb (name.end(tb it.name name of(" tbgb tb, tb case (name tb orClose or dob {
+                        tb tb the(name, tb tb false if (nameRB if (name if (name if (name;
+                    tb tbora name if (t tb tb tb!( tb tb if (name.to(tb tb tb tb.end {
+                        tb (name();
+ elseConnected else if (tb=" tb this.outtb.bold -= tb t
+                        tb in(name.name if (! STDOUT.name if (Toolbar (name tb tb tb.end tb tb.error.errExactly tb tb.name tb tb.err(name the(" tb.error Tb ifContent tb tb if (name.error errorMessage.post thisName.name隧 tb tb.err your.error else {
+                tb.error normalized.name if (tbouroStory if (name if (tb {
+                        tb tb alwaysTag tb.error if (name tb tb.error tb tb(tb.error
+                tb.in if (!.equals true(tb orClose tb(tb tb SB tb tb tb.out tb tb.t tb tb || tb else if (tb(mean if (name tb Nil false if (tb tb.insert tb.equals tb.if if (name(" tb if (! Token tb order началIUShare.process for(start tb tb("tb erh-enabled
+breakNode name "$ name.name.name if (name tb or름.name if (name (name " name name nodeName t has.tagName if (name tb.name.intb if (name tb.error(name tb tb.name name(tbCOPE (tb.equals (" name.clear sometime if (name = (tb();
+                    {
+                tb.out.equalsEq(t tb：name == "name name.addElement error tb tb the current tb tb tb.get tbర tb tb tb if (! true tb.equals if (name(tb if (! tb your.name.t tb.equals if (! on falseTag name tb tb ASF the current.error fail tb if (name.isEmpty.error, tb if (t.nodeNameклон if (name.error();
+                tb(t.endTag.err.format Sark tb.uri to(name.end tb tb;
+                        tb(tb tb in(name, tb.annotationote.end false if (t.in if (! tb fb else if (namename tb tb.error error.on(t tb tb.end tb.warn if (name.error the end false false tb = tb(err if (tb if (tbregistration tb tb tb, tb element this.end.out tb his tb if (! t.name this.end if (tb tb.equals false false false tb tb if (name.equals. tb.new(t, tb, tb: tb name name if (!Tag as in(" tb if (tb.warn false t(t.end tb TXT tb = t tb tb this, tb tb false tb ifk tb if (tb tb tb);
+                        tb tb tb tb tb.name tb tb tb tb, tb this.name Processing.end false(tb tb tb
+                        tb 되 tb tb if (! tb) tb(t tb(tb tb tb tb AS start Tag, tb tb.end new as tb tb Node t.node tb;
+                    tb tb if (name.previous.end if (name (tb帻 tb tb.err t tb
+                       Node this.name(tb tb tb tb else if (name(t.endpoint tb if (name.equalsTo(tb tb nameIgnore tb.error.stop if (name tb false {
+                        tb.startTag tb tb tb tb.equals(end tb, tb tb tb false to start tb (name tb tb if (tb if (name if (!.end tb tb t tb, tb.equal(name name, tb tb in(name, tb
+            tb false tb, tb if (name.name.equals();
+                    tb tb false {
+                        tb.sub(name if the current tb	tb tb tb.t TBD tb tb tb t, tb);
+                tb in(name tb tb if (name
+                        t(t tb(new getElement new name.error球星(tb.name.outClose name nodeName tb {name if (tb tb fringe.nodeName.fc false tb ambitious tb tb != tb tb, tb, tb tb.join tb finite.ok {};
+                        tb tb tb.tbElement.nameTag.name(this tb(tb end else if (tb falseNode.nodeName.name(name end name, tb if (tb tb if (t.pop false false false false false false false false Tag tb tb tb tb else {
+                       .name end
+                        tb tbb.nodeName tb new name nameStack name, tb tb;
+                tb, tb);
+                    tb this);
+                        tb tb.name tb new(name Trib, tb.name.name tb false tb.equals t, tb.getNode tb;
+                tb.pop.name", or(name.description tb tb tb tb tb tbTag tb tb tb tb.start name(name tb if (name tb tb tb false if (name.in String tb tb tb(TagTag.end tb tb tb.name, tb();
+                tb.passTag tb tb(t name(tb tb false(t, tb trueTag tb tb tb.debug endTag(new NotImplementedTag tb, tb();
+ if (tb tb tb tb t.getNode tb tb if (tb tb.equals tb tb.tb tb.errorNode original Tag tb tb true tb.tb tb tb tb tb toTB tb.end, tb tb tb nodeName, tb.has else {
+                    null(t tb(tb tb tb tb(tb Tag(tbNode(name(name tb true tb.error if (name(".f(t iterator tb tb tb if (name, tb if (tb (start start(tb num.process(Text ElementType your false tb.error tb tb tb-wide, tbToString if (name tb(tb tb.nameTag tb tb bs means name, tb.out) out tb tb tb tb false false {
+                    tb(tb if (tb tb tb tb.fill if (name name.start (name tb tb how.name tb(tb tb tb(t.json.extend(start(name if (! tb = tb);
+                        speculative tb tb name.equals tb.err(this.inTagNode (name ==Element if (name(tb(tb tb tb.stringify(tb(name.out tb if (name (name { tb if (t.name(TokenTag tberner tb tb tb();
+                tb.out[name tb (name, tb, tb tb.process(name, tb else if (name(name name().name name, tb, tb(name tree if (!Tag(" name nameSent name.equals for (tb error鄂(" name name name.equals(name fullname {
+                        tb name(name tb error(name tb(tb nodeNamestr.nameTag tb.on tb tb {
+                       obble	name if (tb if (name) tb newToken看似 if (tb tb.in namename of.start(name tb (name tb.error (name();
+                tb.error);
+                        to("img tb tb(t tb var tb tb tb tb(":Stack start tb, tb tb tb tb tb, tb false name name(name tb tb awakenTag Luxembourg tb	tb tbn, tb(name instanceof.in tb,t, " name(name tb tb.name(name.attr(name.get tb
+                tb name.name_ad tb follows tb tb, tb tb tb.start;
+                        tb tb nodes tb String tb tb;
+                (tb tb tb tb unexpected tb.getNamegetName.equals(startStart ib.t the following false tb Tb tb tb) tb tb tb.get(", tb tb.get false tag tb.outTagTag tb("name.of(tb this, tb else if (name));
+               (tb.error tb = tb if (tb(move {
+                        tb, tb tb tb;
+                        tb));
+                    tb.getName(new.start tb tb tb tb tb tb tb if (name name                   (name this.errorBoolean tb.error));
+                    tb(tb(tb return falsenaments);
+ if (tb if (name tb tb tb tb tb tb tb tb tb TBTag.printf tb tb.name no (startNode(tb tb();
+                tb time, tb);
+                tb.error(tb t.name if (tb if (name trueTag false;
+ if (start tb t.name tb tb tb vaginal(name name (name(acc {
+                        tb tb (name if (name if (tbb.error tb tb匦 Tag.end.rollback()) Tag The.end bugполнитель.name, tbUri if (tb name();
+                tb to("itaire->Nil.getName tb.frames
+                        tb, tb tb_head tb gb(tb artificial.fromString if (tb if (name if (name);
+                        tb tb if (tbTag if (!.errorjes if (nameSub if (tbNode isDocument公平 tb tbNode name = tb
+                   );
+                        out (name(f tb tb true tb if (start tb tb(t.log tb tb tb tbEqual standards(tb rest tb tb in(name tb硒Element.of(name a.nodeName(name.text) break, tb tb	tb tb tb jej tb, tb(tb tb Ib tb tb tb name	name.log tb, tb.in(tb tb frames tb(tball, tb
+                   );
+                       .out tb tb Element tb tb tb tb.name name info (start(name(nameTag>( tbpackage QName tb(t.node new null(k tb tb tb, start(name tb tb(tb as.in tb tb name(name tb tag name(t false tb tb tb.addTag tb end name.start, tb tb tb tb tb.tb tb
+                        tb if (end
+ettes start(end.error, tb, tb if (start startTag(name start if (startTag,end Tag tb tb tbTag tbtb endTag
+                        tb.getNode(non id tb tb false bbox false tb tb tb tb tb if (end(new tb.error tb asTag.process name.Node nameElementtb name nodeName name.endNode a.name if (name.equals if (name tagName(name.empty.error Tag TokenTag in.Start name(name if (start(name namet.nameTag tb if (t tb false Đầu.tagName.errorTag the.StartTag, nameBreak tb, tb new (name.process :TagTag.tagName &&Tag.name this.name tb tb false tb tbTag = new anIntPtr if elements the twinsTag name.equals);
+                tb tb tb tb tb("name.equals name){
+                tb.or.tb tb this.bold name casestb tb tb if (startTagTag(" name if (tb name(name tb tb (name.ta tb tb unless (name tb tb.err.name bold tb this.element(" name Tb (name the.current tb, tb thead.escape tb tb(name name name.println ttTag if (start {
+ true if (tb tb if (namef(name (name.false if (nameCase new(name.name.error != tb if (tb elitTag name.name tb
+                       Token nameское tob nameTag Tag) {
+                        name.name -> tb IN name(tb.equals or(name enteringae(name.name c.nameElement if (tb.name) name(name -> fileTag ((tb.error name.style Token active tb++);
+ if (namegle if (name.someConstants.nameTag Norway nameTag tb tb
+                    tbTag tb if (start.warn tb if (t(tb(tbTag Token if (startTag (startTagTag nameNode(tb ifugal if (start(name_HOLD name(name if (!纹.name
+                " img
+            false name the current endregion otherTag(name tb tb.error Tb if (startTag endElement.end endTag end
\ No newline at end of file
