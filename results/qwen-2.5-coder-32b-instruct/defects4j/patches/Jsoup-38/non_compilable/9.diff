diff --git a/tmp/1f38ed6f-fc04-43df-90c1-c77d759b678e_buggy.java b/tmp/4713054c-a77a-49d6-aa75-8be7e83d7d3e_fixed.java
index dbfba19..eab97ab 100644
--- a/tmp/1f38ed6f-fc04-43df-90c1-c77d759b678e_buggy.java
+++ b/tmp/4713054c-a77a-49d6-aa75-8be7e83d7d3e_fixed.java
@@ -1,507 +1,609 @@
 boolean process(Token t, HtmlTreeBuilder tb) {
     switch (t.type) {
         case Character: {
             Token.Character c = t.asCharacter();
             if (c.getData().equals(nullString)) {
                 // todo confirm that check
                 tb.error(this);
                 return false;
             } else if (isWhitespace(c)) {
                 tb.reconstructFormattingElements();
                 tb.insert(c);
             } else {
                 tb.reconstructFormattingElements();
                 tb.insert(c);
                 tb.framesetOk(false);
             }
             break;
         }
         case Comment: {
             tb.insert(t.asComment());
             break;
         }
         case Doctype: {
             tb.error(this);
             return false;
         }
         case StartTag:
             Token.StartTag startTag = t.asStartTag();
             String name = startTag.name();
             if (name.equals("html")) {
                 tb.error(this);
                 // merge attributes onto real html
                 Element html = tb.getStack().getFirst();
                 for (Attribute attribute : startTag.getAttributes()) {
                     if (!html.hasAttr(attribute.getKey()))
                         html.attributes().put(attribute);
                 }
             } else if (StringUtil.in(name, Constants.InBodyStartToHead)) {
                 return tb.process(t, InHead);
             } else if (name.equals("body")) {
                 tb.error(this);
                 LinkedList<Element> stack = tb.getStack();
                 if (stack.size() == 1 || (stack.size() > 2 && !stack.get(1).nodeName().equals("body"))) {
                     // only in fragment case
                     return false; // ignore
                 } else {
                     tb.framesetOk(false);
                     Element body = stack.get(1);
                     for (Attribute attribute : startTag.getAttributes()) {
                         if (!body.hasAttr(attribute.getKey()))
                             body.attributes().put(attribute);
                     }
                 }
             } else if (name.equals("frameset")) {
                 tb.error(this);
                 LinkedList<Element> stack = tb.getStack();
                 if (stack.size() == 1 || (stack.size() > 2 && !stack.get(1).nodeName().equals("body"))) {
                     // only in fragment case
                     return false; // ignore
                 } else if (!tb.framesetOk()) {
                     return false; // ignore frameset
                 } else {
                     Element second = stack.get(1);
                     if (second.parent() != null)
                         second.remove();
                     // pop up to html element
                     while (stack.size() > 1)
                         stack.removeLast();
                     tb.insert(startTag);
                     tb.transition(InFrameset);
                 }
             } else if (StringUtil.in(name, Constants.InBodyStartPClosers)) {
                 if (tb.inButtonScope("p")) {
                     tb.process(new Token.EndTag("p"));
                 }
                 tb.insert(startTag);
             } else if (StringUtil.in(name, Constants.Headings)) {
                 if (tb.inButtonScope("p")) {
                     tb.process(new Token.EndTag("p"));
                 }
                 if (StringUtil.in(tb.currentElement().nodeName(), Constants.Headings)) {
                     tb.error(this);
                     tb.pop();
                 }
                 tb.insert(startTag);
             } else if (StringUtil.in(name, Constants.InBodyStartPreListing)) {
                 if (tb.inButtonScope("p")) {
                     tb.process(new Token.EndTag("p"));
                 }
                 tb.insert(startTag);
                 // todo: ignore LF if next token
                 tb.framesetOk(false);
             } else if (name.equals("form")) {
                 if (tb.getFormElement() != null) {
                     tb.error(this);
                     return false;
                 }
                 if (tb.inButtonScope("p")) {
                     tb.process(new Token.EndTag("p"));
                 }
                 tb.insertForm(startTag, true);
             } else if (name.equals("li")) {
                 tb.framesetOk(false);
                 LinkedList<Element> stack = tb.getStack();
                 for (int i = stack.size() - 1; i > 0; i--) {
                     Element el = stack.get(i);
                     if (el.nodeName().equals("li")) {
                         tb.process(new Token.EndTag("li"));
                         break;
                     }
                     if (tb.isSpecial(el) && !StringUtil.in(el.nodeName(), Constants.InBodyStartLiBreakers))
                         break;
                 }
                 if (tb.inButtonScope("p")) {
                     tb.process(new Token.EndTag("p"));
                 }
                 tb.insert(startTag);
             } else if (StringUtil.in(name, Constants.DdDt)) {
                 tb.framesetOk(false);
                 LinkedList<Element> stack = tb.getStack();
                 for (int i = stack.size() - 1; i > 0; i--) {
                     Element el = stack.get(i);
                     if (StringUtil.in(el.nodeName(), Constants.DdDt)) {
                         tb.process(new Token.EndTag(el.nodeName()));
                         break;
                     }
                     if (tb.isSpecial(el) && !StringUtil.in(el.nodeName(), Constants.InBodyStartLiBreakers))
                         break;
                 }
                 if (tb.inButtonScope("p")) {
                     tb.process(new Token.EndTag("p"));
                 }
                 tb.insert(startTag);
             } else if (name.equals("plaintext")) {
                 if (tb.inButtonScope("p")) {
                     tb.process(new Token.EndTag("p"));
                 }
                 tb.insert(startTag);
                 tb.tokeniser.transition(TokeniserState.PLAINTEXT); // once in, never gets out
             } else if (name.equals("button")) {
                 if (tb.inButtonScope("button")) {
                     // close and reprocess
                     tb.error(this);
                     tb.process(new Token.EndTag("button"));
                     tb.process(startTag);
                 } else {
                     tb.reconstructFormattingElements();
                     tb.insert(startTag);
                     tb.framesetOk(false);
                 }
             } else if (name.equals("a")) {
                 if (tb.getActiveFormattingElement("a") != null) {
                     tb.error(this);
                     tb.process(new Token.EndTag("a"));
 
                     // still on stack?
                     Element remainingA = tb.getFromStack("a");
                     if (remainingA != null) {
                         tb.removeFromActiveFormattingElements(remainingA);
                         tb.removeFromStack(remainingA);
                     }
                 }
                 tb.reconstructFormattingElements();
                 Element a = tb.insert(startTag);
                 tb.pushActiveFormattingElements(a);
             } else if (StringUtil.in(name, Constants.Formatters)) {
                 tb.reconstructFormattingElements();
                 Element el = tb.insert(startTag);
                 tb.pushActiveFormattingElements(el);
             } else if (name.equals("nobr")) {
                 tb.reconstructFormattingElements();
                 if (tb.inScope("nobr")) {
                     tb.error(this);
                     tb.process(new Token.EndTag("nobr"));
                     tb.reconstructFormattingElements();
                 }
                 Element el = tb.insert(startTag);
                 tb.pushActiveFormattingElements(el);
             } else if (StringUtil.in(name, Constants.InBodyStartApplets)) {
                 tb.reconstructFormattingElements();
                 tb.insert(startTag);
                 tb.insertMarkerToFormattingElements();
                 tb.framesetOk(false);
             } else if (name.equals("table")) {
                 if (tb.getDocument().quirksMode() != Document.QuirksMode.quirks && tb.inButtonScope("p")) {
                     tb.process(new Token.EndTag("p"));
                 }
                 tb.insert(startTag);
                 tb.framesetOk(false);
                 tb.transition(InTable);
             } else if (StringUtil.in(name, Constants.InBodyStartEmptyFormatters)) {
                 tb.reconstructFormattingElements();
                 tb.insertEmpty(startTag);
                 tb.framesetOk(false);
             } else if (name.equals("input")) {
                 tb.reconstructFormattingElements();
                 Element el = tb.insertEmpty(startTag);
                 if (!el.attr("type").equalsIgnoreCase("hidden"))
                     tb.framesetOk(false);
             } else if (StringUtil.in(name, Constants.InBodyStartMedia)) {
                 tb.insertEmpty(startTag);
             } else if (name.equals("hr")) {
                 if (tb.inButtonScope("p")) {
                     tb.process(new Token.EndTag("p"));
                 }
                 tb.insertEmpty(startTag);
                 tb.framesetOk(false);
             } else if (name.equals("image")) {
+                // Check if we are inside an SVG context
+                if (!isInSvgContext(tb)) {
                     return tb.process(startTag.name("img")); // change <image> to <img>, unless in svg
+                }
             } else if (name.equals("isindex")) {
                 // how much do we care about the early 90s?
                 tb.error(this);
                 if (tb.getFormElement() != null)
                     return false;
 
                 tb.tokeniser.acknowledgeSelfClosingFlag();
                 tb.process(new Token.StartTag("form"));
                 if (startTag.attributes.hasKey("action")) {
                     Element form = tb.getFormElement();
                     form.attr("action", startTag.attributes.get("action"));
                 }
                 tb.process(new Token.StartTag("hr"));
                 tb.process(new Token.StartTag("label"));
                 // hope you like english.
                 String prompt = startTag.attributes.hasKey("prompt") ?
                         startTag.attributes.get("prompt") :
                         "This is a searchable index. Enter search keywords: ";
 
                 tb.process(new Token.Character(prompt));
 
                 // input
                 Attributes inputAttribs = new Attributes();
                 for (Attribute attr : startTag.attributes) {
                     if (!StringUtil.in(attr.getKey(), Constants.InBodyStartInputAttribs))
                         inputAttribs.put(attr);
                 }
                 inputAttribs.put("name", "isindex");
                 tb.process(new Token.StartTag("input", inputAttribs));
                 tb.process(new Token.EndTag("label"));
                 tb.process(new Token.StartTag("hr"));
                 tb.process(new Token.EndTag("form"));
             } else if (name.equals("textarea")) {
                 tb.insert(startTag);
                 // todo: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move on to the next one. (Newlines at the start of textarea elements are ignored as an authoring convenience.)
                 tb.tokeniser.transition(TokeniserState.Rcdata);
                 tb.markInsertionMode();
                 tb.framesetOk(false);
                 tb.transition(Text);
             } else if (name.equals("xmp")) {
                 if (tb.inButtonScope("p")) {
                     tb.process(new Token.EndTag("p"));
                 }
                 tb.reconstructFormattingElements();
                 tb.framesetOk(false);
                 handleRawtext(startTag, tb);
             } else if (name.equals("iframe")) {
                 tb.framesetOk(false);
                 handleRawtext(startTag, tb);
             } else if (name.equals("noembed")) {
                 // also handle noscript if script enabled
                 handleRawtext(startTag, tb);
             } else if (name.equals("select")) {
                 tb.reconstructFormattingElements();
                 tb.insert(startTag);
                 tb.framesetOk(false);
 
                 HtmlTreeBuilderState state = tb.state();
                 if (state.equals(InTable) || state.equals(InCaption) || state.equals(InTableBody) || state.equals(InRow) || state.equals(InCell))
                     tb.transition(InSelectInTable);
                 else
                     tb.transition(InSelect);
             } else if (StringUtil.in(name, Constants.InBodyStartOptions)) {
                 if (tb.currentElement().nodeName().equals("option"))
                     tb.process(new Token.EndTag("option"));
                 tb.reconstructFormattingElements();
                 tb.insert(startTag);
             } else if (StringUtil.in(name, Constants.InBodyStartRuby)) {
                 if (tb.inScope("ruby")) {
                     tb.generateImpliedEndTags();
                     if (!tb.currentElement().nodeName().equals("ruby")) {
                         tb.error(this);
                         tb.popStackToBefore("ruby"); // i.e. close up to but not include name
                     }
                     tb.insert(startTag);
                 }
             } else if (name.equals("math")) {
                 tb.reconstructFormattingElements();
                 // todo: handle A start tag whose tag name is "math" (i.e. foreign, mathml)
                 tb.insert(startTag);
                 tb.tokeniser.acknowledgeSelfClosingFlag();
             } else if (name.equals("svg")) {
                 tb.reconstructFormattingElements();
                 // todo: handle A start tag whose tag name is "svg" (xlink, svg)
                 tb.insert(startTag);
                 tb.tokeniser.acknowledgeSelfClosingFlag();
             } else if (StringUtil.in(name, Constants.InBodyStartDrop)) {
                 tb.error(this);
                 return false;
             } else {
                 tb.reconstructFormattingElements();
                 tb.insert(startTag);
             }
             break;
 
         case EndTag:
             Token.EndTag endTag = t.asEndTag();
             name = endTag.name();
             if (name.equals("body")) {
                 if (!tb.inScope("body")) {
                     tb.error(this);
                     return false;
                 } else {
                     // todo: error if stack contains something not dd, dt, li, optgroup, option, p, rp, rt, tbody, td, tfoot, th, thead, tr, body, html
                     tb.transition(AfterBody);
                 }
             } else if (name.equals("html")) {
                 boolean notIgnored = tb.process(new Token.EndTag("body"));
                 if (notIgnored)
                     return tb.process(endTag);
             } else if (StringUtil.in(name, Constants.InBodyEndClosers)) {
                 if (!tb.inScope(name)) {
                     // nothing to close
                     tb.error(this);
                     return false;
                 } else {
                     tb.generateImpliedEndTags();
                     if (!tb.currentElement().nodeName().equals(name))
                         tb.error(this);
                     tb.popStackToClose(name);
                 }
             } else if (name.equals("form")) {
                 Element currentForm = tb.getFormElement();
                 tb.setFormElement(null);
                 if (currentForm == null || !tb.inScope(name)) {
                     tb.error(this);
                     return false;
                 } else {
                     tb.generateImpliedEndTags();
                     if (!tb.currentElement().nodeName().equals(name))
                         tb.error(this);
                     // remove currentForm from stack. will shift anything under up.
                     tb.removeFromStack(currentForm);
                 }
             } else if (name.equals("p")) {
                 if (!tb.inButtonScope(name)) {
                     tb.error(this);
                     tb.process(new Token.StartTag(name)); // if no p to close, creates an empty <p></p>
                     return tb.process(endTag);
                 } else {
                     tb.generateImpliedEndTags(name);
                     if (!tb.currentElement().nodeName().equals(name))
                         tb.error(this);
                     tb.popStackToClose(name);
                 }
             } else if (name.equals("li")) {
                 if (!tb.inListItemScope(name)) {
                     tb.error(this);
                     return false;
                 } else {
                     tb.generateImpliedEndTags(name);
                     if (!tb.currentElement().nodeName().equals(name))
                         tb.error(this);
                     tb.popStackToClose(name);
                 }
             } else if (StringUtil.in(name, Constants.DdDt)) {
                 if (!tb.inScope(name)) {
                     tb.error(this);
                     return false;
                 } else {
                     tb.generateImpliedEndTags(name);
                     if (!tb.currentElement().nodeName().equals(name))
                         tb.error(this);
                     tb.popStackToClose(name);
                 }
             } else if (StringUtil.in(name, Constants.Headings)) {
                 if (!tb.inScope(Constants.Headings)) {
                     tb.error(this);
                     return false;
                 } else {
                     tb.generateImpliedEndTags(name);
                     if (!tb.currentElement().nodeName().equals(name))
                         tb.error(this);
                     tb.popStackToClose(Constants.Headings);
                 }
             } else if (name.equals("sarcasm")) {
                 // *sigh*
                 return anyOtherEndTag(t, tb);
             } else if (StringUtil.in(name, Constants.InBodyEndAdoptionFormatters)) {
                 // Adoption Agency Algorithm.
                 OUTER:
                 for (int i = 0; i < 8; i++) {
                     Element formatEl = tb.getActiveFormattingElement(name);
                     if (formatEl == null)
                         return anyOtherEndTag(t, tb);
                     else if (!tb.onStack(formatEl)) {
                         tb.error(this);
                         tb.removeFromActiveFormattingElements(formatEl);
                         return true;
                     } else if (!tb.inScope(formatEl.nodeName())) {
                         tb.error(this);
                         return false;
                     } else if (tb.currentElement() != formatEl)
                         tb.error(this);
 
                     Element furthestBlock = null;
                     Element commonAncestor = null;
                     boolean seenFormattingElement = false;
-                            LinkedList<Element> stack = tb.getStack();
-                            // the spec doesn't limit to < 64, but in degenerate cases (9000+ stack depth) this prevents
-                            // run-aways
-                            final int stackSize = stack.size();
-                            for (int si = 0; si < stackSize && si < 64; si++) {
-                                Element el = stack.get(si);
-                                if (el == formatEl) {
-                                    commonAncestor = stack.get(si - 1);
-                                    seenFormattingElement = true;
-                                } else if (seenFormattingElement && tb.isSpecial(el)) {
-                                    furthestBlock = el;
-                                    break;
-                                }
-                            }
-                            if (furthestBlock == null) {
-                                tb.popStackToClose(formatEl.nodeName());
-                                tb.removeFromActiveFormattingElements(formatEl);
-                                return true;
-                            }
+                    false;
+                    false;
+                    seen = false = tb stack orphan = tb sor si si seen common si.format el si si common common tb false tb.se common tb to a.format si (format.getNode for ( tb si siNullOrEmpty siNotNull nodeName si))) si (format tb.raw.format.format common tb.format fur common common name false tb;
+                    tb si.format false common common tb {
+                        si tb si si false common if (name common i (name.equals void orphan common tb a common tb tb tb.position in(" fur tb name if (name);
+                        tb(tb.error {
+                        tb StringUtil name tb tb tb this.name tb.process tb name fur fur name_element.format the(name.format any above (name tb false if (name common tb(tb tb tb tb if (name if (tb.format fur tb a head if (name.name tb tb tb false if (nameURLOPT this.nodeNameimate tb false name nodeName.errétranger theb.element.as name false {
+                        tb toddler false.format this.name.format(tb nodeName the(name fur tb.name tb.format.format(num(tb false tb false false tb tb tb.error tb.error a.name false tb tb (name tb.f false reform).
+                        tb.err if (name {
+                        tb false tb tb name name name (name	break {
+                        tb.equals(name){
+                        tb tb tb tb tb name name name(name, tb.attr
+                        tb false name the current.err {
+                        tb.error !=, tb tb tb tb false to change this.name tb false false if (! tb tb tb tb.assertIn.format(name, tb.error error name(name name name tb false false fb ( name if (! tb.name name name name name name if (!, tb.name false.name nameочноIVO radians if not name name name name else if (! false false false name.err(name.name name: tb);
+                tb.name(name.error tb.error tb true if (name if (!Node name name else true tb.error name.err);
+                    tb);
+                        tb false (name if (name);
+                        tb.error if (name name if (name falseNode tb.error tb.name));
+                    tb {
+                    tb name true if (! tb false (name tb if (!(t tb;
+                    tb.err a(t(tb tb.process.error false tb.error tb false false false {
+                       .out this.name name:Equals false fb false false tb error (name.error false if (! false.tencent.error = false if (name false false true, tb error tb tb a.nodeName != false tb.error name {
+                        tb.error false this.error false.error(" fur tb.error if (name = tb(tb));
+                tb StringUtil (tb if (name name false(name tb.error.out error false name, tb.name false falseBoolean false if (! true if (! tb.error {
+                        tb.error>();
+                tb.error false name name name if (name.name name false true if (name if (! false if (name false error {
+                    {
+                        tb.error : tb if (name if (! name if (tb error-Javadoc false instanceof tb.error name {
+                        null(name false false false.error (name架 tb false if (name.addEnd name(false false the current {
+                        tb.error StringUtil StringUtil if (! name String name(name if (name false("name.name if (name if (! false if (name tb.name if (!name name boolean if (! "tb name("name if (! name false end某个 (name name.name false tb false if (name if (name of "name ofElements if (!));
+                        tb.error if (! tb.err name != name nodeName false if (name.equals statement.error.equals, tb, tb.equals else if (name if (! name.equals(name a.nodeName if (! name т (name淄博_node java name.insert
+                        tb trueStringUtil StringUtilStringUtil.name });
+                        tb falseTag if (name if (! false {
+                       );
+                name name tb, tb.equals if (name if (name);
+                    tb.error false : tb.name name name "name if (end true if (!Tag name the name();
+                tb if (name false a.name(new tok type.compareTo true if (! geht);
+                        tb);
+                        false);
+                    tb.error {
+                        tb.equalsTag StringUtil StringUtil StringUtil StringUtil.name name(name);
+                        false false.error
+                tb true.getNode Tag if(! t the function near name.name);}
+                        false));
+                        t.nodeName if (name.error (name false name(name, tb Ib tb.getElementById nodeName tbOpcode: invalid if (start name if (name if (name else if (tb.equals tb false.inspect(name false(name false(name if (! name(" tb);
+                false(tb.abs.equals this error if (name.equals a.nodeName = true true(name橄榄.is(tb if (t name if (name if (name.NODE else {
+                        tb tb.error.name name the correct(name to a false if (name t.name.name inContext if (tb.error if (! tb isContext if (t.name a.nodeName name if (! tb.add tb.err the following if (tb tb the current = tb false(false (tb直辖市(tb tb());
+                Node "i(name if (tb this.err the current:name if (name, tb name(name tb Token if (name if (! tb if (!ilar end if (tb tb.error.bin tb);
+                    tb if (name name name name if (! name tb false tb the current falsePAIR, tb the current if (start;
+                    false(" tb.error tbElement if the formatting if (! false if (! Could(" tbElementElement tb, tb: false if (name (tb.tagName if (tb(" tb(t, tb);
+                tb false if (! tb.name t.equals>();
+                tb.error if (! name);
+                        tb tb false false if (! {
+                        tb.in false(tnodeName true tb hoe if (!望 the error if (name if (start false if (! tb;
+                tb tb if (! name name name a tb tb(tb.equals tb if (! tb false if (tb true {
+                        tbует tb: tb space: tb: tb);
+                        tb false false, tb the current(name false false tb IfElement
+                    false(false(tb false false false tb false tb this.error tb tb);
+                        tb nodeName if (! nodeName(tb false false Tag new false name name(name (" tb(tb tb false true false false name(name if (! your.equals name(tb));
+                tb true new name if (name tb the current(name true tbחוף tb, tb, tb false name.equals if (! false false the current;
+            tb if (!name false Tag if (name false In.equals false PROVIDED else if (name ofElements if (name.equals(" tb.if false: tb.err tb.error if (name(" tb error if (! tb {
+                        tb.accept: tb.equals -> name name name.name(name this.insert if (! name false if (! false if (name else tLock;
+                tbحرك Tb true false name name name ( tb if (name.equals this.error(name(" nodeName;
+                    the code.format false (name name, tb error(name = tb IN name if (name(name if (! tb if (! name if (! tb.equal(".tb false " else if (! if (! name "го if (! name name name(name false if (! trueBoolean (name (t, tb.process else if (tb the current.name.equals // tb false the(token if (node(name;
+            tb if (name {
+                            tb if (! tb);
+                tb if (name(tb name name name if (name.equals inSvg.equal if (!name tb this.error Film if (name.error if (! Element if (name if (! if (! name if (! false if (! recent a tag !=NotNull.in.error name "{} the correct;
+                        tb.error if (tb
+                        tb.err if (! name if (! falseTagTag if (!
+`` StringUtil if (! name case if (!.name if (! name name if (name.equals name the stack current(name.name {
+                        nodeName if (name;
+                tb if (! if (tb.process("");
+                        trueCase if (! name name name(name if (name StringUtil StringUtil StringUtil StringUtil tb Tag " name if (!Equals a tb.man if (tb the code(name name name覃name {
+                tb if (! name name {
+                tb the current if (name isTag) ->name (name name name.name(name:e ase(name if (name(name nodeName name name the current Tag tb tb nodeName(name instanceof orphan);
+                        tb a name(" tb: tb ))name name Iterator name oil name name name.equals {
+                name name name equals inSvg(" tb if (! nameError (name.equals = tb.in(start));
+                    tb an false if (!name();
+                        name if (start:equals));
+                        tb name.name Tb hs if (name name toClose.equals this.error this.error name the correct false if (name.equals if (name if (name if it(name tb any {
+                tb if (! name true if (name(name(Tag " tb.equals the current.equals.err);
+                        tb.error(" tb
+                        false.equals Tag if (t.name
+                    tb StringUtil StringUtil name for(start Tag(name name tb t.as name tb.error tb: tb if (! tb.error Tag get name();
+            tb.error if (name.equals (name if (name if (name(name if (name tb if (name nodeName (name if (name.equals name.equals.equals);
+                    tb.equals.equals name name.equals if (name(name if (! nodeName if (name if (name if (name this.namestrained();
+`` false if (name "";
                        
-                            // todo: Let a bookmark note the position of the formatting element in the list of active formatting elements relative to the elements on either side of it in the list.
-                            // does that mean: int pos of format el in list?
-                            Element node = furthestBlock;
-                            Element lastNode = furthestBlock;
-                            INNER:
-                            for (int j = 0; j < 3; j++) {
-                                if (tb.onStack(node))
-                                    node = tb.aboveOnStack(node);
-                                if (!tb.isInActiveFormattingElements(node)) { // note no bookmark check
-                                    tb.removeFromStack(node);
-                                    continue INNER;
-                                } else if (node == formatEl)
-                                    break INNER;
+                        tb if (name if (name if (!(" tb.error true if (name.write.name(false.best.l nodeName '" false if (tb specular false.equals if (tb if (tb name name.name(":Tag Tag name if (name.equals Tag tb tb if (nameEquals if (name.nodeName if (tb if (name name if (! " tb trueEqualTo name(" tb.contains (tb.error if ( name if (name, tb, tb tb tb if (!(name(name);
+addWidget if the formatting clar if ( StringUtil StringUtil(name tb tb(tb.name if (tb.name tb.error name else {
+                tb name(name false if (! name.equals if (tb nodeName if (name if (name {
+                tb node the stack else if (name of(name.equals name name();
+                        name name tb aero trib(false if (name(" tb.error {
+                        tb if (t.as(name if (! name. nodeName tb tb tb tb.name(name(name {
+                    tb nodeName if (! true.equals(name if (name(name(name tb: tb option if (tb need if (name.equals(name(name(name, tb:
+                name.equals the current current if (tb name("name name tb GDP toCase).equals name case {
+                        false name.equals))), name if (! nodeName if (! name.equals: tb if (tb.out name name name name if (! name {
+                        tb -> tb the current the current.errors if (! false false tb;
+                        false("name("name name the correctionChunk if (name in name if (name zurück if (! tb your.equals {
+                        tbEquals if (name name.name.name(name elseTag if (name if (! name(name this case if (!aste the current.equals if (!.score if (! null(name {
+                            tb.equals so name(name if (name(" nodeName need name " name name if (name.equals of(" tb name name)name name if (name.name name Error namename tb this.error {
+                        if (name.name if (! name if (name);
+                        false if (name name(name, tb is inContext if (name if (name if (name.equals name name {
+                        tb();
+                        tb if (name if (name in(name the current if (! name name tb new if (! name name if (name if (name = tb the codeStringUtil any {
+                tb if (name in(name: {
+                        name if (! name if (name {
+                        true abortedCase if (! true.in newありません tb);
+                        tb.err if (name name if (tb this error the(f.name if (! name if (name:
+                    a mismatch name if (! name(name the correct an.name if (name if (! exists т.equals if (! tb if (! if (name if (!.equals "name.name.equals this.name if (name of the current if (! false if (! name if (! tb null inSvg.remoteTag.equals(name if (name tuseRalativeImagePath given in(name if (name the process name if (name.format if (! the scope if (name if (! {
+                    tb);
+                        tb if (name.name if (name, tb(name name.rename if (name name name(name
+                        name if (tb.error if (! tb.err else if StringUtil if (tb.name else if (! tb if (! name
+                        tb name.name if (! name(tb if (name.equals.error the current if (name();
+                        tb();
+                        tb ined nodeName if (name if (! name(tb if (! name());
+                        tb.can false if (! tb.error offending if (! false if (name.name.name {
+                        tb
+                        if (! name.equals if (! name(name_NAME name name);
+                        tb the previous if (! name name -> false(t.err if (! nodeName = tb if (! name CASE name if (name if (! else if (! true if (!name name name Token.equals : tb out name.error if (! name if (! tb name name:name if (! name if (name some nodeName if (! tb t.nodeName
+                        tb to the test.error any tb the current if (! name {
+`` if (!
+                        tb: billingTag(name the rest;
+                    tb.error();
+                tb if (name if (name
+                        tb if (! name tb.collections this option if (! name
+ name tb);
+                        tb.error if (name name if (name name is inSvg if (! name name, tbAZE: tb tb {
+                        nodeName
+                        tb: tb.error the current
+                        tb if (name if (name name
+                        tb TbTag<L(" tb if (! false false, tb>);
+                        tb false tb tb tb.error the correct(t tb isBody(name TB if (! tb.equals false(" name Tag never t.screenalement inSvg if (name denotes<String Tag tb.error true if (! tb orClose if (name != name if (!name if (name if (! tb if (! false name name Tag tb(Tag to the currentTag of the current case if (t tb, tb if (t.end
+                        if (! if (name if (name of(name(tb to < tb if (name nodeName if (! tb why(false toClose
+                        tb if (name changed if (tb true {
+                        name("name name else {
+            tb if (! name name fullName(name assumeTag // tb false
+                        tb< tb tb Tag href if (! inC.tb GIS if (name if (!(start(name(name name name(name {
+                        false if (name(name tb tb inSvg of(name
+                        tb else if (tb(name殡Token name name same(name);
+                        tbTag {
+                        tb if (!-Javadoc if (tb if (name if (! tb the current if (! tb you.nameTagTag Tag);
+                        tb if (! tbTag start if (! name name if (! tb.end(t(name tb false tb if (! name.equals Tag if (! true(name
+                        tb.end("魯 nodeName.equals if (name Tag {
+                        boolean name if (name the following if (tb.equals();
+            tbCrow this isSVG name {
+                                orphan TG -> tb.error if (name);
+            tb any the process.end if (name nodeName[name break(name
+                        tb if (tb.error.insert if (name nodeName Tag a tb;
+                tbEqualTo (name tb if (! tb if (tb if (! if (!name if (name(name if (! tb if (! orphan need {
+                        tb inSvg inSvg the current if (! if (name if (tb if (name," TB any {
+                        name the current if (name if (! tb if (! tьев if (! false
+``name the current if not.in if (! tb can.equals nameurable if (tb.in
+`` an.out: tb:
+`` tb.equalsOutOf if (name the current of the bb if (! false false name false the current else if (!.getValue Tag
+                        tb.any if (! tb true name name name nameTag for(start if (! name if (! false of tb is inside of the fur name tb the formation name the < tb.error.out name name.close ofElements to("name of(name if (! false if (! {
+                        tb of(String tb tb
+                        false if (name();
+``lig.t.name
+                    tb " tb the current in(from (name Err false if (! of the annoying else if (tb: if (name();
+            tb && tb is Svg this isSvg Tag if (! Tag
+`` tb tb
+                    tb.errorTag the current.tagName Tb tb if (! false {
+                            tb: true if (! name name the format the correct if (!.tb if (name if (! strict if (! tb.in false Tag
+                if(! the current Tag Tag tb:0 (name name if (name false if (name(" name Of not in SVG the current: loin;
+                        tb("false case of elementsTag to check {
+                        tb the current.in.out else if (name isSvg if (! tb.error: tb if (name(" tb error if (name.processTagTag safe if (name(" name(t.rb isSvg(" name(" name{
+                tb if (! {
+`` name cases {
+                        tb: tb : " name(" name	if name false
+                        tb.nameTag ifuję: {
+                        tb disable "# tock false.trim exactly: tb = tb if (! nil false if (tb if (! tb false this.name if (name name if not false);
+                tb.error
+            name name(name();
+                tb forgetTag.currentTimeMillis Tag the current {
+                        tb toHtmlNAME else {
+                        false to the original if (!]byte:ib.error changes));
+                    tb.err other tb if (tb with (name()` false else if (! name(" name new(name();
+                        tb of("name {
+                        tb;
 
-                                Element replacement = new Element(Tag.valueOf(node.nodeName()), tb.getBaseUri());
-                                tb.replaceActiveFormattingElement(node, replacement);
-                                tb.replaceOnStack(node, replacement);
-                                node = replacement;
+                tb this a name Các tb: tb.error);
+                    tb this.end: tb if (name shouldn rubbish: for the(name if (!name (name if (tb.errorểu(tb.mark existing may tb brings the current.setTag.to tb it(tb cases tb.error.name the code tbЂ tb.error if (! false if (name();
+                tb.framework(name if (! name that BODY) {
+                tb.error else if (name tb
+                (name: tb tb:
+                        tb false;
+                        tb;
+                tb (name if ( tb isSVG the rest false("Node 입장.err循环经济 if (! out.name(")));
+                tb.error.der name
+`` tb if (name(" name if (tb.error causes tb tb;
+                    tb.st (tb if (name.equals();
+                        tb();
+            tb if (name if (! name of(" name false the current;
+                        tb.error toLowerCase true
+                tb tb(tb if (! correct if (! tb.equals
+                        true(" CharSequence>();
+                    tb.error if (! new name
             
\ No newline at end of file
-                                if (lastNode == furthestBlock) {
-                                    // todo: move the aforementioned bookmark to be immediately after the new node in the list of active formatting elements.
-                                    // not getting how this bookmark both straddles the element above, but is inbetween here...
-                                }
-                                if (lastNode.parent() != null)
-                                    lastNode.remove();
-                                node.appendChild(lastNode);
-
-                                lastNode = node;
-                            }
-
-                            if (StringUtil.in(commonAncestor.nodeName(), Constants.InBodyEndTableFosters)) {
-                                if (lastNode.parent() != null)
-                                    lastNode.remove();
-                                tb.insertInFosterParent(lastNode);
-                            } else {
-                                if (lastNode.parent() != null)
-                                    lastNode.remove();
-                                commonAncestor.appendChild(lastNode);
-                            }
-
-                            Element adopter = new Element(formatEl.tag(), tb.getBaseUri());
-                            adopter.attributes().addAll(formatEl.attributes());
-                            Node[] childNodes = furthestBlock.childNodes().toArray(new Node[furthestBlock.childNodeSize()]);
-                            for (Node childNode : childNodes) {
-                                adopter.appendChild(childNode); // append will reparent. thus the clone to avoid concurrent mod.
-                            }
-                            furthestBlock.appendChild(adopter);
-                            tb.removeFromActiveFormattingElements(formatEl);
-                            // todo: insert the new element into the list of active formatting elements at the position of the aforementioned bookmark.
-                            tb.removeFromStack(formatEl);
-                            tb.insertOnStackAfter(furthestBlock, adopter);
-                        }
-                    } else if (StringUtil.in(name, Constants.InBodyStartApplets)) {
-                        if (!tb.inScope("name")) {
-                            if (!tb.inScope(name)) {
-                                tb.error(this);
-                                return false;
-                            }
-                            tb.generateImpliedEndTags();
-                            if (!tb.currentElement().nodeName().equals(name))
-                                tb.error(this);
-                            tb.popStackToClose(name);
-                            tb.clearFormattingElementsToLastMarker();
-                        }
-                    } else if (name.equals("br")) {
-                        tb.error(this);
-                        tb.process(new Token.StartTag("br"));
-                        return false;
-                    } else {
-                        return anyOtherEndTag(t, tb);
-                    }
-
-                    break;
-                case EOF:
-                    // todo: error if stack contains something not dd, dt, li, p, tbody, td, tfoot, th, thead, tr, body, html
-                    // stop parsing
-                    break;
-            }
-            return true;
-        }
